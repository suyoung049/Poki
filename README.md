# <img src= "https://github.com/po-do/Poki/assets/59272854/16bfc906-8f7e-43c3-910b-99213139dcc9"  height="40px" width="40px" style="margin-bottom: -5px"> Poki
### í¬í‚¤(Poki) - ë¶€ëª¨-ìë…€ ì†Œí†µì„ ë†’ì´ëŠ” ì˜¨ë¼ì¸ í”Œë«í¼
<p align="center"><img src= "https://github.com/po-do/Poki/assets/126448936/bb1aaa88-d053-4487-86e1-2c812b7c0db1"  height="25%" width="25%"></p>

- **Poki**ëŠ” ë§ë²Œì´ ê°€ì •ì˜ ë¶€ëª¨ë‹˜ê³¼ ì•„ì´ë“¤ì„ ìœ„í•œ ìƒí˜¸ì‘ìš© ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.  
- ë¶€ëª¨ë‹˜ì€ ë©€ë¦¬ ìˆëŠ” ìë…€ì™€ë„ OK! ì•„ì´ë“¤ê³¼ ëŠê»´ë³´ì§€ ëª»í–ˆë˜ ì†Œì¤‘í•œ ê²½í—˜ì„ ìŒ“ì•„ë³´ì„¸ìš”.

## ğŸ“‹ í”„ë¡œì íŠ¸ í¬ìŠ¤í„°
<p align="center"><img src= "https://github.com/po-do/Poki/assets/59272854/9bea9973-579a-4740-8d78-d05d2a82d2d9"  height="50%" width="50%"></p>

[poster.pdf](https://github.com/po-do/Poki/files/11980391/poster.pdf)

## ğŸ§ How to use
* ë¡œê·¸ì¸ í›„ ìë…€ì™€ ë¶€ëª¨ë‹˜ì€ ê³ ìœ  ì½”ë“œë¡œ ì—°ê²°í•˜ê²Œ ë©ë‹ˆë‹¤.
* ìë…€ëŠ” ê°€ì§€ê³  ì‹¶ì€ ì„ ë¬¼ì„ ê²€ìƒ‰í•˜ì—¬ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ë¶€ëª¨ë‹˜ì€ ìë…€ê°€ ë“±ë¡í•œ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ê³  ìë…€ì—ê²Œ ì£¼ê³  ì‹¶ì€ ì„ ë¬¼ì„ ì„ íƒí•˜ê²Œ ë˜ê³  í¬ë„ì•Œ ëª¨ìœ¼ê¸°ë¥¼ ì‹œì‘í•˜ê²Œ ë©ë‹ˆë‹¤.
* ë¶€ëª¨ë‹˜ì€ ìë…€ì—ê²Œ ë¯¸ì…˜ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ìë…€ëŠ” ë¯¸ì…˜ì„ ìˆ˜í–‰í•˜ê³  í¬ë„ì•Œì„ ë°›ê²Œ ë©ë‹ˆë‹¤.
* 31ê°œì˜ í¬ë„ì•Œì„ ëª¨ìœ¼ê²Œ ë˜ë©´ ë¶€ëª¨ë‹˜ì€ ìë…€ì—ê²Œ ì„ ë¬¼ì„ ì£¼ê²Œ ë©ë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥
![image](https://github.com/po-do/Poki/assets/59272854/c172114f-9af3-4c8a-a779-c6908419a633)

### ğŸš€ í¬ë„ì•Œ ëª¨ìœ¼ê¸°
31ê°œì˜ í¬ë„ì•Œì„ ëª¨ì•„ë³´ì„¸ìš”.

![í¬ë„ì•Œë¶™íˆê¸°](https://github.com/po-do/Poki/assets/108652367/a2f74213-2bcb-4a29-b91d-1401b0777e92)


### ğŸš€ ì„ ë¬¼ ê²€ìƒ‰
ì›í•˜ëŠ” ì„ ë¬¼ì„ ì„ íƒí•´ ë³´ì„¸ìš”.

![ì„ ë¬¼ê²€ìƒ‰](https://github.com/po-do/Poki/assets/108652367/efa51a65-2d61-4d96-8fc3-f8baddf52e2d)


### ğŸš€ AI ë¯¸ì…˜ ì¶”ì²œ
AIë¥¼ í™œìš©í•˜ì—¬ ë¯¸ì…˜ì„ ì¶”ì²œë°›ì•„ ë³´ì„¸ìš”.

![AIë¯¸ì…˜ ì¶”ì²œ](https://github.com/po-do/Poki/assets/108652367/927acb66-da03-4883-93ae-6a336269b8d7)


### ğŸš€ ë¯¸ì…˜ ì˜ˆì•½
ë¯¸ì…˜ì„ ì˜ˆì•½í•´ ë³´ì„¸ìš”.

![ë¯¸ì…˜ì˜ˆì•½](https://github.com/po-do/Poki/assets/108652367/50168ec3-fdc3-4878-aca6-b0482da14a74)


### ğŸš€ ì±„íŒ…
ì±„íŒ…ìœ¼ë¡œ ë¶€ëª¨ë‹˜ê³¼ ì†Œí†µí•´ë³´ì„¸ìš”.
### ğŸš€ í™”ìƒ í†µí™”
ë¶€ëª¨ë‹˜ê³¼ í™”ìƒ í†µí™”ë¥¼ í•´ë³´ì„¸ìš”.

![í™”ìƒí†µí™”](https://github.com/po-do/Poki/assets/108652367/949eb612-e4d8-4d31-87c2-47b2b585eee6)


### ğŸš€ ì›¹-ì•±
ëª¨ë°”ì¼ì—ì„œ ì„¤ì¹˜í•˜ì—¬ ì›¹ê³¼ ì•±ì—ì„œ ëª¨ë‘ ì‚¬ìš©í•´ë³´ì„¸ìš”.
### ğŸš€ ìº˜ë¦°ë”
ìº˜ë¦°ë”ë¡œ í¬ë„ì•Œ ë° ì„ ë¬¼ì„ ì¤€ ê¸°ë¡ì„ í™•ì¸í•´ ë³´ì„¸ìš”.

![ìº˜ë¦°ë”](https://github.com/po-do/Poki/assets/108652367/7c8d2d7f-4f5d-4dd2-8e1a-9d94fd1ab742)


### ğŸš€ ì•Œë¦¼
ë©”ì‹œì§€, í™”ìƒí†µí™”, ë¯¸ì…˜ ë“±ì˜ ì•Œë¦¼ì„ ë°›ì•„ë³´ì„¸ìš”.

![ì•Œë¦¼](https://github.com/po-do/Poki/assets/108652367/f614dcb2-af6d-4b17-a81e-d04df9b6f0d6)


## ğŸ“š í”„ë¡œì íŠ¸ ì§„í–‰ì‹œ ë§¡ì€ ë¶€ë¶„
- Board & Wishlist CRUD ì„¤ê³„

  - ìœ ì €ê°„ Board  ë™ê¸°í™”ë¥¼ ìœ„í•œ Client-Server  í†µì‹  ë°©ì‹ ê°œì„ 

    - ìë…€ì˜ Whishlist ì¤‘ì— ì„ ë¬¼ì„ ì„ íƒ, í¬ë„ ê°œìˆ˜ 31ê°œ ì™„ë£Œí›„ ì„ ë¬¼ ì¦ì • -> Board ìƒì„±, ì‚­ì œ í•„ìš”

    - ë¶€ëª¨ê°€ ìë…€ì—ê²Œ í¬ë„ì•Œì„ ì¦ì •í•˜ê±°ë‚˜, ìë…€ê°€ í¬ë„ì•Œì„ ë¶™íê²½ìš° ì„œë¡œì˜ í™”ë©´ì— ì •ë³´ ë™ê¸°í™” í•„ìš”

    - ì„œë¹„ìŠ¤ ë©”ì¸í˜ì´ì§€ì—ì„œëŠ” ìœ„ì˜ ë‹¤ìˆ˜ì˜ ì´ë²¤íŠ¸ë“¤ì´ ë°œìƒ, ë°œìƒ í•  ë•Œë§ˆë‹¤ ë³´ë“œì˜ ì •ë³´ê°€ í•„ìš”

    - ì´ˆê¸° ì„¤ê³„ì‹œ Poling ë°©ì‹ìœ¼ë¡œ ê°ê°ì˜ ì´ë²¤íŠ¸ê°€ ì „ë¶€ Board ì˜ ìƒíƒœë¥¼ ìš”ì²­ -> ì„œë²„ ê³¼ë¶€í™” ë°œìƒ

    - ì²˜ìŒ ë©”ì¸ í˜ì´ì§€ì—ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— Boardì˜ ìƒíƒœë¥¼ ìš”ì²­í›„ ëŒ€ê¸°, ì´ë²¤íŠ¸ ë°œìƒì‹œ ì„œë²„ ì¸¡ì—ì„œ ìƒíƒœë¥¼ ì‘ë‹µí•˜ëŠ” SSE ë°©ì‹ìœ¼ë¡œ ë³€ê²½ 

      

  - ì†ŒìŠ¤ ì½”ë“œ

    - ë©”ì¸í˜ì´ì§€ ì ‘ì†ì‹œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ  Board ìƒíƒœ ìš”ì²­ -> ì„œë²„ ì¸¡ ì²˜ìŒ Board ìƒíƒœ ì‘ë‹µí›„ ëŒ€ê¸°

    ```javascript
    let globalVersion = 0; // Global version variable(ì „ì—­ë³€ìˆ˜ ì§€ì •)
    @Sse('/grape/sse/user')
        async sseGetBoardByUserId(
          @GetUser() user: User,
          @GetUserId() id: number,
          @GetUserType() type: string,
        ): Promise<Observable<responseSseBoardDto>> {
      
          if (type !== 'PARENT') {
            id = await this.AuthService.getConnectedUser(user);
          }
          const use_grape = await this.boardService.getBoardByUserId(id);
          return new Observable<responseSseBoardDto>((observer) => {
            let localVersion = 0; // Local version variable
            const initialData = async () => {
                // ë§¨ ì²˜ìŒ ë³´ë“œ ìƒíƒœë¥¼ ë¶ˆëŸ¬ì˜´(Board ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°)          
                if (!use_grape) {
                    const initialResponse: responseSseBoardDto = {
                        data: {
                            code: 200,
                            success: true,
                            grape: {
                                id:0,
                                blank: 0,
                                total_grapes: 0,
                                attached_grapes: 0,
                                deattached_grapes: 0,
                            },
                            is_existence: false,
                        },
                    };
                    observer.next(initialResponse);
                    localVersion = globalVersion;
                  // Update the local version
                    return;
                }
              // ë§¨ ì²˜ìŒ ë³´ë“œ ìƒíƒœë¥¼ ë¶ˆëŸ¬ì˜´(Board ì¡´ì¬í•  ê²½ìš°)
                const initialResponse: responseSseBoardDto = {
                    data: {
                    code: 200,
                    success: true,
                    grape: await this.boardService.getBoardByUserId(id),
                    is_existence: true,
                    },
                };
                observer.next(initialResponse);
                localVersion = globalVersion;
                // Update the local version
                };
    ```

    - ìë…€ê°€ í¬ë„ì•Œì„ ë¶™íˆê±°ë‚˜ ì—¬ëŸ¬ ì´ë²¤íŠ¸ ë°œìƒì‹œ ì„œë²„ì¸¡ì—ì„œ Boardì˜ ìƒíƒœ ì „ì†¡

    ```javascript
     //í¬ë„ ë¶€ì°© ë²„íŠ¼ í´ë¦­ì‹œ ì‹¤í–‰ í•¨ìˆ˜
        @Post('/grape/attach')
        async attachBoard(
        ): Promise<responseBoardDto> {
            globalVersion += 1; // ì„œë²„ì—ì„œ ì´ë²¤íŠ¸ ë°œìƒ í™•ì¸
            return response
        }
    
    ---------------------------------------------------------------------------------------
         
        // ë‹¤ë¥¸ ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ê²½ìš°(ëŒ€ê¸°ì¤‘ì¸ ì„œë²„ì—ì„œ ì´ë²¤íŠ¸ ë°œìƒì‹œ Board ìƒíƒœ ì‘ë‹µ)
              if (localVersion < globalVersion) {
                const use_grape = await this.boardService.getBoardByUserId(id);
                // ë§¨ ì²˜ìŒ ë³´ë“œ ìƒíƒœë¥¼ ë¶ˆëŸ¬ì˜´(Wishlist ì¦ì •ìœ¼ë¡œ ì¸í•œ Board ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°)
                if (!use_grape) {
                    const response: responseSseBoardDto = {
                        data: {
                            code: 200,
                            success: true,
                            grape: {
                                id:0,
                                blank: 0,
                                total_grapes: 0,
                                attached_grapes: 0,
                                deattached_grapes: 0,
                            },
                            is_existence: false,
                        },
                    };
                    observer.next(response);
                    localVersion = globalVersion; // Update the local version
                    return;
                }
                // ë§¨ ì²˜ìŒ ë³´ë“œ ìƒíƒœë¥¼ ë¶ˆëŸ¬ì˜´(Board ì¡´ì¬í•  ê²½ìš°)
                const response: responseSseBoardDto = {
                  data: {
                    code: 200,
                    success: true,
                    grape: await this.boardService.getBoardByUserId(id),
                    is_existence: true,
                  },
                };
                observer.next(response);
                localVersion = globalVersion; // Update the local version
              }
            };
            initialData(); 
            const intervalId = setInterval(updateData, 500);
            // í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì—°ê²°ì´ ëŠì–´ì¡Œì„ ê²½ìš°
            observer.complete = () => {
              clearInterval(intervalId);
            };
            
            localVersion = globalVersion;
            return observer;
          });
    
    ```

    - Chat WebSocket ë°±ì—”ë“œ ë¶€ë¶„ ì„¤ê³„

  - ì±„íŒ… ë‚´ì—­ ì €ì¥

    - ìƒëŒ€ë°©ê³¼ì˜ ì±„íŒ… ë‚´ì—­ ì €ì¥ì„ ìœ„í•´  eventGateway ì¸¡ì—ì„œ Message ì •ë³´ ì§ì ‘ ì €ì¥
  
      ```javascript
        @SubscribeMessage('message')
          async handleMessage(
              @ConnectedSocket() socket: Socket,
              @MessageBody() { roomName, message, user }: MessagePayload,
          ) {
              // Save message in database
              this.eventService.createMessage(user.user_id, message, roomName, user.id, user.name);
      
              socket.to(roomName).emit('message', { sender_id: user.user_id, message, check_id: user.id, createdAt: new Date(), sender_name: user.name });
      
              return { sender_id: user.user_id, message, check_id: user.id, createdAt: new Date(), sender_name: user.name };
          }
      ```
  
    - ì €ì¥ëœ ì±„íŒ… ë‚´ì—­ ì±„íŒ… ì‘ì„±ëœ ì‹œê°„ ìˆœìœ¼ë¡œ  ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì— ì‘ë‹µ
  
      ```javascript
          async getMessage(room_name: string): Promise<Message[]> {
              const messages = await this.messageRepository
                .createQueryBuilder('message')
                .where('message.conversation_id = :room_name', { room_name })
                .orderBy('message.createdAt', 'ASC')
                .getMany();
            
              return messages ;
            }
      ```
  
  - ì±„íŒ… ì•Œë¦¼ì„ ìœ„í•œ ì±„íŒ…ë°© ì…ì¥/ë¹„ì…ì¥ í‘œì‹œ êµ¬í˜„
  
    - ì±„íŒ…ë°©ì— ìƒëŒ€ë°© ì—†ì„ì‹œ ë©”ì„¸ì§€ ë‚´ìš© ì•Œë¦¼ìœ¼ë¡œ ì „ì†¡í•˜ëŠ” ê¸°ëŠ¥ êµ¬í˜„
  
    - êµ¬í˜„ ìœ„ì— ìœ ì €ê°€ ì±„íŒ… í˜ì´ì§€ì— ì…ì¥ì‹œ ì§€ì •ëœ DBì— ì €ì¥
  
    - ìœ ì €ê°€ ì±„íŒ… í˜ì´ì§€ì— ë‚˜ê°ˆ ì‹œ DBì—ì„œ ì‚­ì œ 
  
      ```javascript
      //ìœ ì € ì±„íŒ…ë°©ì— ì…ì¥ì‹œ
       @SubscribeMessage('setUserName')
          async handleSetUserName(
              @MessageBody() data: { user_id: string },
              @ConnectedSocket() socket: Socket
          ) {
              await this.eventService.createChatSocketConnection(data.user_id, socket.id);
          }
      -----------------------------------------------------------------------------------------------
      // ìœ ì € ì±„íŒ…ë°© í‡´ì¥ì‹œ
       @SubscribeMessage('disconnect')
          async handleDisconnect(@ConnectedSocket() socket: Socket) {
              try {
                  const disconnectedUser = await
                  this.eventService.findChatConnectionBySocketId(socket.id);
                  if (disconnectedUser) {
                      this.eventService.deleteChatConnection(disconnectedUser)
                  }
              } catch (error) {
                  this.logger.error(error);
              }
      
          }
          
      ```
  
    - DBì— ìœ ì € ì¡´ì¬ ì—¬ë¶€ì— ë”°ë¥¸ ì…ì¥/ë¹„ì…ì¥ í‘œì‹œ
  
      ```javascript
      //@SubscribeMessage('message')
      const now_user = await this.authService.getUserById(user.id);
              // ì±„íŒ…ë°©ì— ìƒëŒ€ë°©ì´ ìˆëŠ”ì§€ í™•ì¸
              const connect_userId = await this.authService.getConnectedUser_id(now_user);
      
              const check = await this.eventService.checkChatConnection(connect_userId);
      
              if (!check) {
      
                  try {
      
                      const connect_id = await this.authService.getConnectedUser(now_user);
                      const pushToken = await this.pushService.getPushToeknByUserId(connect_id);
      
                      const title = 'ìƒˆë¡œìš´ ë©”ì‹œì§€ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤.';
                      let info;
      
                      if (!message.startsWith('/static/media')) {
                          info = message;
                      }
                      else {
                          info = 'ì´ëª¨í‹°ì½˜ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.'
                      }
                      await this.pushService.push_noti(pushToken, title, info);
                  } catch (exception) {
                      if (exception instanceof ForbiddenException) {
                          return { sender_id: user.user_id, message, check_id: user.id, createdAt: new Date(), sender_name: user.name };
                      }
      
                  }
              }
      ```

    


## ğŸ“š ê¸°ìˆ ìŠ¤íƒ

| ë¶„ë¥˜                      | ê¸°ìˆ                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Frontend**              | <img src="https://img.shields.io/badge/react-61DAFB?style=for-the-badge&logo=react&logoColor=white"> <img src="https://img.shields.io/badge/tailwindcss-38B2AC?style=for-the-badge&logo=tailwind-css&logoColor=white"> <img src="https://img.shields.io/badge/firebase-FFCA28?style=for-the-badge&logo=firebase&logoColor=white"> <img src="https://img.shields.io/badge/pwa-5A0FC8?style=for-the-badge&logo=pwa&logoColor=write"> <img src="https://img.shields.io/badge/recoil-362d59?style=for-the-badge&logo=recoil&logoColor=white">    |
| **Backend**               | <img src="https://img.shields.io/badge/nestjs-E0234E?style=for-the-badge&logo=nestjs&logoColor=white"> <img src="https://img.shields.io/badge/PM2-2B037A?style=for-the-badge&logo=PM2&logoColor=white"> |
| **WebRTC**              | <img src="https://img.shields.io/badge/WebRTC-333333?style=for-the-badge&logo=webRTC&logoColor=white"> <img src="https://img.shields.io/badge/socket.io-010101?style=for-the-badge&logo=socket.io&logoColor=white"> <img src="https://img.shields.io/badge/PeerJS-F1680D?style=for-the-badge&logoColor=white">
| **Database**              | <img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white"> <img src="https://img.shields.io/badge/redis-DC382D?style=for-the-badge&logo=redis&logoColor=white">                                                                                                                 |
| **Infrastructure/DevOps** |  <img src="https://img.shields.io/badge/aws_Route_53-A100FF?style=for-the-badge&logo=amazonaws&logoColor=white"> <img src="https://img.shields.io/badge/aws_CouldFront-A100FF?style=for-the-badge&logo=amazonaws&logoColor=white"> <img src="https://img.shields.io/badge/aws_alb-A100FF?style=for-the-badge&logo=amazonaws&logoColor=white"> <img src="https://img.shields.io/badge/aws_ACM-E21E29?style=for-the-badge&logo=amazonaws&logoColor=white"> <img src="https://img.shields.io/badge/aws_s3-569A31?style=for-the-badge&logo=amazonaws&logoColor=white"> <img src="https://img.shields.io/badge/githubactions-2088FF?style=for-the-badge&logo=githubactions&logoColor=white">          |

## ğŸ§© ì„œë¹„ìŠ¤ êµ¬ì¡°ë„
![poki-service](https://github.com/po-do/Poki/assets/126448821/eca35817-6d3e-415c-9f70-c6d94043be4e)

## ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦ íŒ€ì›ì†Œê°œ
<table>
  <tbody>
    <tr>
      <td align="center"><img src="https://github.com/po-do/Poki/assets/59272854/2a77b2bd-f7cd-4326-ae27-e2fdc41e0bda"width="150px;" alt=""/><br /><sub><b><a href="https://github.com/jy604">BE íŒ€ì¥ : ë°•ì •ì˜</a></b></sub><br /></td>
      <td align="center"><img src="https://github.com/po-do/Poki/assets/59272854/5d3b0cb7-d147-49d2-8195-7a6ecc229a22" width="150px;" alt=""/><br /><sub><b><a href="https://github.com/suyoung049">BE íŒ€ì› : ì´ìˆ˜ì˜</a></b></sub><br /></td>
      <td align="center"><img src="https://github.com/po-do/Poki/assets/59272854/2002e3cf-0f50-4583-ab50-bf5ed219693d" width="150px;" alt=""/><br /><sub><b><a href="https://github.com/Jeon-Yoojin">BE íŒ€ì› : ì „ìœ ì§„</a></b></sub><br /></td>
      <td align="center"><img src="https://github.com/po-do/Poki/assets/59272854/7f671376-0e53-4442-9884-5fa1b8f76081" width="150px;" alt=""/><br /><sub><b><a href="https://github.com/jaewon4">FE íŒ€ì› : ê¹€ì¬ì›</a></b></sub><br /></td>
      <td align="center"><img src="https://github.com/po-do/Poki/assets/59272854/e2671a23-7c87-44d9-9088-19fcd8e4f29b" width="150px;" alt=""/><br /><sub><b><a href="https://github.com/swssue">FE íŒ€ì› : ì§€ìˆ˜í˜„</a></b></sub><br /></td>
    </tr>
  </tbody>
</table>
